MCOPY_memory_expansion_cost:

  _info:
    comment: Test cases for the memory expansion cost in the MCOPY instruction

  env:
    currentNumber: 1
    currentTimestamp: 1687174231
    currentGasLimit: 1000000
    currentCoinbase: 2adc25665018aa1fe0e6bc666dac8fc2697ff9ba

  pre:

    # Executed code (transaction destination)
    000000000000000000000000000000000000c0de:
      balance: 0
      nonce: 1
      code: |
        :yul {
          function mcopy(dst, src, size) { verbatim_3i_0o(hex"5e", dst, src, size) }
        
          // Take most of the SSTORE cost before MCOPY. 
          sstore(0, 1)
        
          // MCOPY using parameters from CALLDATA.
          mcopy(calldataload(0), calldataload(32), calldataload(64))
        
          // Put MSIZE in storage.
          sstore(0, msize())
        }
      storage:
        0: fa11ed  # Placeholder for final MSIZE value (memory size is a multiply of 32)

    # Transaction sender
    a94f5374fce5edbc8e2a8697c15331677e6ebf0b:
      balance: 1000000000
      nonce: 0
      code: ''
      storage: { }

  transaction:
    to: 000000000000000000000000000000000000c0de
    nonce: 0
    gasLimit:
      - 100000
    gasPrice: 10
    value:
      - 0
    secretKey: 45a915e4d060149eb4365960e6a7a45f334393093061116b197e3240065ff2d8
    data:
      - >
        :label dst0_src0_size0 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000000
      - >
        :label dst0_src31_size706 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000000
        000000000000000000000000000000000000000000000000000000000000001f
        00000000000000000000000000000000000000000000000000000000000002c2
      - >
        :label dst31_src0_size706 :raw 0x
        000000000000000000000000000000000000000000000000000000000000001f
        0000000000000000000000000000000000000000000000000000000000000000
        00000000000000000000000000000000000000000000000000000000000002c2
      - >
        :label dst62_src31_size706 :raw 0x
        000000000000000000000000000000000000000000000000000000000000003e
        000000000000000000000000000000000000000000000000000000000000001f
        00000000000000000000000000000000000000000000000000000000000002c2
      - >
        :label dst31_src62_size706 :raw 0x
        000000000000000000000000000000000000000000000000000000000000001f
        000000000000000000000000000000000000000000000000000000000000003e
        00000000000000000000000000000000000000000000000000000000000002c2
      - >
        :label dst62_src62_size706 :raw 0x
        000000000000000000000000000000000000000000000000000000000000003e
        000000000000000000000000000000000000000000000000000000000000003e
        00000000000000000000000000000000000000000000000000000000000002c2
      - >
        :label dst64_src0_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000040
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label dst0_src64_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000040
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label dst64_src33_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000040
        0000000000000000000000000000000000000000000000000000000000000021
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label dst33_src64_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000021
        0000000000000000000000000000000000000000000000000000000000000040
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label dst1_src33_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000001
        0000000000000000000000000000000000000000000000000000000000000021
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label dst33_src1_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000021
        0000000000000000000000000000000000000000000000000000000000000001
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label dst33_src33_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000021
        0000000000000000000000000000000000000000000000000000000000000021
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label dst64_src64_size1344 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000040
        0000000000000000000000000000000000000000000000000000000000000040
        0000000000000000000000000000000000000000000000000000000000000540
      - >
        :label huge_size0 :raw 0x
        ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
        ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
        0000000000000000000000000000000000000000000000000000000000000000
      - >
        :label huge_src0_size1 :raw 0x
        ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000001
      - >
        :label huge_dst0_size1 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000000
        ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
        0000000000000000000000000000000000000000000000000000000000000001
      - >
        :label huge_size_n255 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000000
        8000000000000000000000000000000000000000000000000000000000000000
      - >
        :label huge_dst0_size_n256 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000001
        ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
      - >
        :label huge_src0_size_n256 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000001
        0000000000000000000000000000000000000000000000000000000000000000
        ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
      - >
        :label huge_size_n63 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000000000000000000000
        0000000000000000000000000000000000000000000000008000000000000000
      - >
        :label huge_size_n64 :raw 0x
        0000000000000000000000000000000000000000000000000000000000000001
        0000000000000000000000000000000000000000000000000000000000000001
        000000000000000000000000000000000000000000000000ffffffffffffffff

  expect:

    - indexes:
        data:
          - :label dst0_src0_size0
          - :label huge_size0
      network:
        - '>=Cancun'
      result:
        000000000000000000000000000000000000c0de:
          storage:
            0: 0

    - indexes:
        data:
          - :label dst0_src31_size706
          - :label dst31_src0_size706
          - :label dst62_src31_size706
          - :label dst31_src62_size706
          - :label dst62_src62_size706
      network:
        - '>=Cancun'
      result:
        000000000000000000000000000000000000c0de:
          storage:
            0: 768

    - indexes:
        data:
          - :label dst64_src0_size1344
          - :label dst0_src64_size1344
          - :label dst64_src33_size1344
          - :label dst33_src64_size1344
          - :label dst1_src33_size1344
          - :label dst33_src1_size1344
          - :label dst33_src33_size1344
          - :label dst64_src64_size1344
      network:
        - '>=Cancun'
      result:
        000000000000000000000000000000000000c0de:
          storage:
            0: 1408

    - indexes:
        data:
          - :label huge_src0_size1
          - :label huge_dst0_size1
          - :label huge_size_n255
          - :label huge_dst0_size_n256
          - :label huge_src0_size_n256
          - :label huge_size_n63
          - :label huge_size_n64
      network:
        - '>=Cancun'
      result:
        000000000000000000000000000000000000c0de:
          storage:
            0: fa11ed
